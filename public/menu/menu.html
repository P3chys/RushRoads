<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rush Roads</title>
    <link rel="stylesheet" href="./styles/menu.css">
</head>

<body>

    <div class="menu-container" id="main-menu">
        <h1>Car Game</h1>
        <button class="menu-button" onclick="startNewGame()">New Game</button>
        <button class="menu-button" onclick="openShop()">Shop</button>
        <button class="menu-button" onclick="changeCarModel()">Change Car Model</button>
        <button class="menu-button" onclick="instructions()">Instructions</button>
    </div>

    <div class="menu-container" id="level-select" style="display: none;">
        <a href="menu.html" class="back-button">Back</a>
        <h1>Select Level</h1>
        <button class="menu-button" id="level-1" onclick="selectLevel(1)">Level 1 <span
                class="map-distance"></span></button>
        <button class="menu-button" id="level-2" onclick="selectLevel(2)">Level 2 <span
                class="map-distance"></span></button>
        <button class="menu-button" id="level-3" onclick="selectLevel(3)">Level 3 <span
                class="map-distance"></span></button>
    </div>

    <script>
        function startNewGame() {
            if (sessionStorage.getItem("user_exists") === null) {
                sessionStorage.setItem("user_exists", true);
                sessionStorage.setItem("coins", 0);
                sessionStorage.setItem("map1", true);
                sessionStorage.setItem("map2", false);
                sessionStorage.setItem("map3", false);
                sessionStorage.setItem("car1", true);
                sessionStorage.setItem("car2", false);
                sessionStorage.setItem("car3", false);
                sessionStorage.setItem("invincible", 0);
                sessionStorage.setItem("slow-down", 0);
                sessionStorage.setItem("distance_map_1", 0);
                sessionStorage.setItem("distance_map_2", 0);
                sessionStorage.setItem("distance_map_3", 0);
                sessionStorage.setItem("currentCar", 1);
            }
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('level-select').style.display = 'block';
            displayMapDistances();
            checkMapLocks();
        }

        function openShop() {
            window.location.href = "shop.html"
        }

        function instructions() {
            window.location.href = "./instructions.html"
        }

        function changeCarModel() {
            if(sessionStorage.getItem("user_exists")===null){
                startNewGame();
            }
            window.location.href = "./car_selection.html"
        }

        function selectLevel(level) {
            sessionStorage.setItem("currentMap", level);
            window.location.href = "http://localhost:5173"
        }

        function displayMapDistances() {
            const distances = [

                sessionStorage.getItem('distance_map_1'),
                sessionStorage.getItem('distance_map_2'),
                sessionStorage.getItem('distance_map_3')
            ];

            document.getElementById('level-1').querySelector('.map-distance').innerText = `${Math.trunc(distances[0])}m`;
            document.getElementById('level-2').querySelector('.map-distance').innerText = `${Math.trunc(distances[1])}m`;
            document.getElementById('level-3').querySelector('.map-distance').innerText = `${Math.trunc(distances[2])}m`;
        }

        function checkMapLocks() {
            const map2Locked = sessionStorage.getItem('map2') === 'false';
            const map3Locked = sessionStorage.getItem('map3') === 'false';

            if (map2Locked) {
                lockMap('level-2');
            }
            if (map3Locked) {
                lockMap('level-3');
            }
        }

        function lockMap(levelId) {
            const levelButton = document.getElementById(levelId);
            levelButton.disabled = true;
            levelButton.innerHTML += ' <span class="lock">ðŸ”’</span>';
            levelButton.classList.add('locked');
        }
    </script>
</body>

</html>